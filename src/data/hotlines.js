export const NATIONAL_HOTLINE = {
  label: 'National immigration hotline list',
  url: 'https://nnirr.org/education-resources/community-resources-legal-assistance-recursos-comunitarios-asistencia-legal/immigration-hotlines-lineas-directas-de-inmigracion/'
}

export const STATE_HOTLINES = {
  AZ: {
    entries: [
      {
        label: 'No More Deaths (missing migrant hotline)',
        phone: '520-585-5881'
      },
      {
        label: 'Colibrí Center for Human Rights (missing migrant hotline)',
        phone: '520-724-8644'
      }
    ]
  },
  CA: {
    entries: [
      {
        label: 'California Trust Act Hotline (statewide)',
        phone: '1-844-878-7801'
      },
      {
        label: 'Aguilas del Desierto (missing migrant hotline)',
        phone: '760-521-3768'
      },
      {
        label: 'SIREN text alerts (community)',
        phone: '1-201-468-6088'
      },
      {
        label: 'SIREN text alerts (allies)',
        phone: '1-918-609-4480'
      },
      {
        label: 'PaseLaVoz text alerts',
        phone: '1-415-715-9990'
      }
    ],
    localEntries: [
      {
        area: 'Alameda County, CA',
        match: ['Alameda County'],
        entries: [
          {
            label: 'Alameda County Rapid Response',
            phone: '1-510-241-4011'
          }
        ]
      },
      {
        area: 'Central Valley, CA',
        match: ['Fresno County', 'San Joaquin County', 'Merced County', 'Kern County'],
        entries: [
          {
            label: 'Central Valley Rapid Response Network',
            phone: '1-559-206-0151'
          }
        ]
      },
      {
        area: 'Contra Costa County, CA',
        match: ['Contra Costa County'],
        entries: [
          {
            label: 'Contra Costa Rapid Response Network',
            phone: '1-925-900-5151'
          }
        ]
      },
      {
        area: 'Humboldt County, CA',
        match: ['Humboldt County'],
        entries: [
          {
            label: 'Humboldt Rapid Response Network',
            phone: '1-707-282-5226'
          }
        ]
      },
      {
        area: 'Los Angeles County, CA',
        match: ['Los Angeles County', 'Los Angeles'],
        entries: [
          {
            label: 'Coalicion for Humane Immigration (Los Angeles)',
            phone: '1-888-624-4752'
          }
        ]
      },
      {
        area: 'Marin County, CA',
        match: ['Marin County'],
        entries: [
          {
            label: 'Marin County Rapid Response Network',
            phone: '1-415-991-4545'
          }
        ]
      },
      {
        area: 'Sonoma & Napa Counties, CA',
        match: ['Sonoma County', 'Napa County'],
        entries: [
          {
            label: 'North Bay Rapid Response Network',
            phone: '1-707-800-4544'
          }
        ]
      },
      {
        area: 'Monterey County, CA',
        match: ['Monterey County'],
        entries: [
          {
            label: 'Monterey County Rapid Response Network',
            phone: '1-831-643-5225'
          }
        ]
      },
      {
        area: 'Sacramento County, CA',
        match: ['Sacramento County', 'Sacramento'],
        entries: [
          {
            label: 'Sacramento Rapid Response Hotline',
            phone: '1-916-245-6773'
          }
        ]
      },
      {
        area: 'San Diego County, CA',
        match: ['San Diego County', 'San Diego'],
        entries: [
          {
            label: 'San Diego Rapid Response Network',
            phone: '1-619-536-0823'
          }
        ]
      },
      {
        area: 'San Francisco County, CA',
        match: ['San Francisco County', 'San Francisco'],
        entries: [
          {
            label: 'SF Immigrant Legal & Education Network',
            phone: '1-415-200-1548'
          }
        ]
      },
      {
        area: 'Santa Clara County, CA',
        match: ['Santa Clara County'],
        entries: [
          {
            label: 'Santa Clara County Rapid Response',
            phone: '1-408-290-1144'
          }
        ]
      },
      {
        area: 'Santa Cruz County, CA',
        match: ['Santa Cruz County'],
        entries: [
          {
            label: 'Santa Cruz County Rapid Response',
            phone: '1-831-239-4289'
          }
        ]
      }
    ]
  },
  CO: {
    entries: [
      {
        label: 'Colorado Immigrant Rights Coalition Rapid Response',
        phone: '1-844-864-8341'
      }
    ]
  },
  FL: {
    entries: [
      {
        label: 'Florida Immigrant Coalition Hotline',
        phone: '1-888-600-5762'
      }
    ]
  },
  GA: {
    localEntries: [
      {
        area: 'Atlanta, GA',
        match: ['Atlanta', 'Fulton County'],
        entries: [
          {
            label: 'Georgia Latino Alliance for Humane Rights',
            phone: '1-770-457-5232'
          },
          {
            label: 'Asian American Advancing Justice',
            phone: '1-404-890-5655'
          }
        ]
      }
    ]
  },
  IL: {
    localEntries: [
      {
        area: 'Chicago, IL',
        match: ['Chicago', 'Cook County'],
        entries: [
          {
            label: 'Illinois Coalition for Immigrant & Refugee Rights',
            phone: '1-855-435-7693'
          }
        ]
      }
    ]
  },
  KY: {
    entries: [
      { 
        label: "Community Response Coalition of Kentucky (CRCKY)",
        phone: '1-800-674-9217'
      }
    ]
  },
  MI: {
    localEntries: [
      {
        area: 'Grand Rapids, MI',
        match: ['Grand Rapids', 'Kent County'],
        entries: [
          {
            label: 'Grand Rapids Rapid Response (daytime, Mon-Fri 6am-6pm)',
            phone: '211'
          },
          {
            label: 'Grand Rapids Rapid Response (after hours)',
            phone: '616-238-0081'
          }
        ]
      }
    ]
  },
  NM: {
    entries: [
      {
        label: 'New Mexico Migra Watch Hotline',
        phone: '1-844-363-1423 ext. 102'
      },
      {
        label: 'No More Deaths (missing migrant hotline)',
        phone: '520-585-5881'
      },
      {
        label: 'Colibrí Center for Human Rights (missing migrant hotline)',
        phone: '520-724-8644'
      }
    ]
  },
  NY: {
    entries: [
      {
        label: 'New Americans Hotline (statewide)',
        phone: '1-800-566-7636'
      },
      {
        label: 'New York/New Jersey Rapid Response Network',
        phone: '1-800-308-0878'
      }
    ],
    localEntries: [
      {
        area: 'New York City, NY',
        match: [
          'New York City',
          'NYC',
          'Manhattan',
          'Brooklyn',
          'Queens',
          'Bronx',
          'Staten Island',
          'New York County',
          'Kings County',
          'Queens County',
          'Bronx County',
          'Richmond County'
        ],
        entries: [
          {
            label: 'Immigrant Defense Project',
            phone: '1-212-725-6422'
          },
          {
            label: 'NYC Immigrant Affairs (9am-5pm)',
            phone: '1-800-354-0365'
          },
          {
            label: 'ActionNYC (after hours)',
            phone: '311'
          }
        ]
      },
      {
        area: 'Long Island, NY',
        match: ['Long Island', 'Nassau County', 'Suffolk County'],
        entries: [
          {
            label: 'Long Island Dream Act Coalition',
            phone: '1-516-387-2043'
          }
        ]
      },
      {
        area: 'Ithaca/Tompkins County, NY',
        match: ['Ithaca', 'Tompkins County'],
        entries: [
          {
            label: 'Ithaca/Tompkins Rapid Response',
            phone: '607-358-5119'
          }
        ]
      },
      {
        area: 'Ulster County, NY',
        match: ['Ulster County'],
        entries: [
          {
            label: 'Ulster Rapid Response',
            phone: '845-293-3423'
          }
        ]
      }
    ]
  },
  NJ: {
    entries: [
      {
        label: 'New York/New Jersey Rapid Response Network',
        phone: '1-800-308-0878'
      }
    ]
  },
  NC: {
    entries: [
      {
        label: 'Alerta Migratoria',
        phone: '1-984-377-2622'
      }
    ]
  },
  MD: {
    entries: [
      {
        label: 'CASA Raid Response Hotline',
        phone: '1-301-431-4185'
      }
    ]
  },
  VA: {
    localEntries: [
      {
        area: 'Northern Virginia',
        match: ['Fairfax County', 'Arlington County', 'Loudoun County', 'Prince William County', 'Alexandria'],
        entries: [
          {
            label: 'Northern Virginia Family Service legal hotline',
            phone: '1-571-748-2806'
          }
        ]
      }
    ]
  },
  DC: {
    entries: [
      {
        label: 'Sanctuary DMV Hotline',
        phone: '1-202-335-1183'
      }
    ]
  },
  OR: {
    localEntries: [
      {
        area: 'Portland, OR',
        match: ['Portland', 'Multnomah County'],
        entries: [
          {
            label: 'Immigrants Rights Coalition (Portland area)',
            phone: '1-888-622-1510'
          }
        ]
      }
    ]
  },
  PA: {
    localEntries: [
      {
        area: 'Philadelphia, PA',
        match: ['Philadelphia', 'Philadelphia County'],
        entries: [
          {
            label: 'New Sanctuary Movement (Philadelphia)',
            phone: '1-267-333-9530'
          }
        ]
      }
    ]
  },
  TX: {
    entries: [
      {
        label: 'South Texas Human Rights Center (missing migrant hotline)',
        phone: '1-361-325-2555'
      }
    ],
    localEntries: [
      {
        area: 'Houston, TX',
        match: ['Houston', 'Harris County'],
        entries: [
          {
        label: "Houston Immigrants' Rights Hotline",
            phone: '1-833-468-4664'
          }
        ]
      },
      {
        area: 'Austin & Travis County, TX',
        match: ['Austin', 'Travis County'],
        entries: [
          {
            label: 'Austin & Travis County Rapid Response',
            phone: '1-512-270-1515'
          },
          {
            label: 'Community Defense Line (text WATCHICE)',
            phone: '877877'
          }
        ]
      }
    ]
  },
  UT: {
    localEntries: [
      {
        area: 'Salt Lake City, UT',
        match: ['Salt Lake City', 'Salt Lake County'],
        entries: [
          {
            label: 'Comunidades Unidas (Salt Lake City)',
            phone: '1-801-487-4143'
          }
        ]
      }
    ]
  },
  WA: {
    entries: [
      {
        label: 'Washington Immigration Solidarity Network',
        phone: '1-844-724-3737'
      }
    ],
    localEntries: [
      {
        area: 'King County, WA',
        match: ['King County'],
        entries: [
          {
            label: 'King County legal services hotline',
            phone: '1-206-816-3870'
          }
        ]
      }
    ]
  },
  WI: {
    entries: [
      {
        label: 'Voces de la Frontera (statewide)',
        phone: '1-800-427-0213'
      }
    ]
  }
}

export const US_STATES = [
  { code: 'AL', name: 'Alabama' },
  { code: 'AK', name: 'Alaska' },
  { code: 'AZ', name: 'Arizona' },
  { code: 'AR', name: 'Arkansas' },
  { code: 'CA', name: 'California' },
  { code: 'CO', name: 'Colorado' },
  { code: 'CT', name: 'Connecticut' },
  { code: 'DE', name: 'Delaware' },
  { code: 'FL', name: 'Florida' },
  { code: 'GA', name: 'Georgia' },
  { code: 'HI', name: 'Hawaii' },
  { code: 'ID', name: 'Idaho' },
  { code: 'IL', name: 'Illinois' },
  { code: 'IN', name: 'Indiana' },
  { code: 'IA', name: 'Iowa' },
  { code: 'KS', name: 'Kansas' },
  { code: 'KY', name: 'Kentucky' },
  { code: 'LA', name: 'Louisiana' },
  { code: 'ME', name: 'Maine' },
  { code: 'MD', name: 'Maryland' },
  { code: 'MA', name: 'Massachusetts' },
  { code: 'MI', name: 'Michigan' },
  { code: 'MN', name: 'Minnesota' },
  { code: 'MS', name: 'Mississippi' },
  { code: 'MO', name: 'Missouri' },
  { code: 'MT', name: 'Montana' },
  { code: 'NE', name: 'Nebraska' },
  { code: 'NV', name: 'Nevada' },
  { code: 'NH', name: 'New Hampshire' },
  { code: 'NJ', name: 'New Jersey' },
  { code: 'NM', name: 'New Mexico' },
  { code: 'NY', name: 'New York' },
  { code: 'NC', name: 'North Carolina' },
  { code: 'ND', name: 'North Dakota' },
  { code: 'OH', name: 'Ohio' },
  { code: 'OK', name: 'Oklahoma' },
  { code: 'OR', name: 'Oregon' },
  { code: 'PA', name: 'Pennsylvania' },
  { code: 'RI', name: 'Rhode Island' },
  { code: 'SC', name: 'South Carolina' },
  { code: 'SD', name: 'South Dakota' },
  { code: 'TN', name: 'Tennessee' },
  { code: 'TX', name: 'Texas' },
  { code: 'UT', name: 'Utah' },
  { code: 'VT', name: 'Vermont' },
  { code: 'VA', name: 'Virginia' },
  { code: 'WA', name: 'Washington' },
  { code: 'WV', name: 'West Virginia' },
  { code: 'WI', name: 'Wisconsin' },
  { code: 'WY', name: 'Wyoming' },
  { code: 'DC', name: 'District of Columbia' }
]

const STATE_ALIASES = {
  washingtondc: 'DC',
  districtcolumbia: 'DC',
  districtofcolumbia: 'DC'
}

const STATE_NAME_TO_CODE = US_STATES.reduce((acc, state) => {
  acc[normalizeStateName(state.name)] = state.code
  return acc
}, {})

const STATE_CODE_TO_NAME = US_STATES.reduce((acc, state) => {
  acc[state.code] = state.name
  return acc
}, {})

export function normalizeStateName(name = '') {
  return name
    .toLowerCase()
    .replace(/[^a-z]/g, '')
}

export function normalizePlaceName(name = '') {
  return name
    .toLowerCase()
    .replace(/[^a-z]/g, '')
}

export function getStateCodeFromName(name) {
  if (!name) return null
  const normalized = normalizeStateName(name)
  return STATE_ALIASES[normalized] || STATE_NAME_TO_CODE[normalized] || null
}

export function getStateNameFromCode(code) {
  if (!code) return null
  return STATE_CODE_TO_NAME[code.toUpperCase()] || null
}

const findLocalMatch = (localEntries, targets) => {
  if (!Array.isArray(localEntries) || targets.length === 0) return null

  return localEntries.find((entry) => {
    if (!entry?.match?.length) return false
    return entry.match.some((value) => targets.includes(normalizePlaceName(value)))
  })
}

export function getHotlineForLocation({ stateCode, locality, county } = {}) {
  const normalizedStateCode = stateCode ? stateCode.toUpperCase() : null

  if (!normalizedStateCode) {
    return { ...NATIONAL_HOTLINE, isFallback: true, matchType: 'national', areaLabel: null }
  }

  const stateName = getStateNameFromCode(normalizedStateCode)
  const stateData = STATE_HOTLINES[normalizedStateCode]

  if (!stateData) {
    return { ...NATIONAL_HOTLINE, isFallback: true, matchType: 'national', areaLabel: stateName }
  }

  const targets = [locality, county]
    .filter(Boolean)
    .map((value) => normalizePlaceName(value))

  const localMatch = findLocalMatch(stateData.localEntries, targets)
  if (localMatch) {
    return {
      entries: localMatch.entries,
      isFallback: false,
      matchType: 'local',
      areaLabel: localMatch.area || stateName
    }
  }

  if (Array.isArray(stateData.entries) && stateData.entries.length > 0) {
    return {
      entries: stateData.entries,
      isFallback: false,
      matchType: 'state',
      areaLabel: stateName
    }
  }

  return { ...NATIONAL_HOTLINE, isFallback: true, matchType: 'national', areaLabel: stateName }
}

export function getHotlineForState(stateCode) {
  return getHotlineForLocation({ stateCode })
}
